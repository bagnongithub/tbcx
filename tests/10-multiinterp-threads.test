# -*-Tcl-*-
package require tbcx
package require tcltest 2.5
namespace import ::tcltest::*

testConstraint haveThread [expr {![catch {package require Thread}]}]

test thread.2 {thread + sub-interpreter} -constraints haveThread -body {
    set in  [makeFile {return "combo-ok"} thread.2-in.tcl]
    set out [makeFile "" thread.2-out.tbcx]
    tbcx::save $in $out
    set tid [thread::create]
    thread::send $tid {interp create J}
    thread::send $tid {interp eval J {package require tbcx}}
    set res [thread::send $tid [list interp eval J [list tbcx::load $out]]]
    thread::send $tid {interp delete J}
    thread::release $tid
    set res
} -result combo-ok

cleanupTests
